---
title: Visualizing COVID-19 Data Using R
author: Sharan S.
output: html_document
knit: (function(inputFile, encoding) { 
  rmarkdown::render(inputFile,
    encoding=encoding, output_file='index.html') })
---

Researchers at [Our World in Data](https://ourworldindata.org/coronavirus-source-data) have aggregated data on COVID-19 cases, deaths, vaccinations, etc from various sources such as WHO and Johns Hopkins University, and made it available in a GitHub repository.

I will be using this dataset to visualize various COVID-19 related metrics, and also test some hypotheses relating to the nature of COVID-19 cases.

```{r, include=FALSE}
library(skimr)
library(tidyverse)
```

### Total Per-Capita COVID-19 cases in Canada over time

First, I'll import the dataset as such.

```{r, message=FALSE, cache=TRUE}
canada_cases <- read_csv("https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/jhu/total_cases_per_million.csv")
```

The raw data has each country's cases in its own column, and dates in rows. To tidy this data, I'll first filter out only the relevant countries and gather the country info under one column.

```{r}
canada_cases <- canada_cases %>%
  select(date, World, Canada, `United States`) %>%
  gather(key = country, value = cases, -date)

skim_without_charts(canada_cases)
```

Now, this data can be visualized using `ggplot2`.

```{r, fig.align="center"}
ggplot(canada_cases, aes(x = date, y = cases)) +
  geom_line(aes(color = country)) +
  scale_y_log10() +
  scale_x_date(date_labels = "%b %y", date_breaks = "2 months",
    guide = guide_axis(angle = 60)) +
  labs(title = "Total Per-Capita COVID-19 Cases Over Time",
    x = "Time", y = "Confirmed COVID-19 cases (per million)",
    caption = "Source: Our World in Data")
```

### New Per-Capita COVID-19 Cases in Canada over Time

As I did before, I'll import the relevant data from OWID.

```{r, message=FALSE, cache=TRUE}
canada_new_cases <- read_csv("https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/jhu/new_cases_per_million.csv")
```

Everything I mentioned about the formatting of the other CSV file holds true for this, too. Each country's data is in its own column, and each date's data are in their own rows.

```{r}
canada_new_cases <- canada_new_cases %>%
  select(date, World, Canada, `United States`) %>%
  gather(key = country, value = cases, -date)
```

Now, this data can be plotted. However, if I use the same method as I did with the prior dataset, it is hard to visualize any clear trends due to the fluctuations by week. This is especially apparent after July 2021.

```{r, fig.align="center"}
ggplot(canada_new_cases, aes(x = date, y = cases)) +
  geom_line(aes(color = country)) +
  scale_x_date(date_labels = "%b %y", date_breaks =  "2 months",
    guide = guide_axis(angle = 60)) +
  labs(title = "New Per-Capita COVID-19 Cases Over Time",
    x = "Time", y = "Confirmed COVID-19 cases (per million)",
    caption = "Source: Our World in Data")
```

So, to make the trends more clear, I'll plot the individual data points (as opposed to a line graph) and include a smoothened trendline.

```{r, fig.align="center"}
ggplot(canada_new_cases, aes(x = date, y = cases)) +
  geom_jitter(aes(color = country), size = 0.1) +
  geom_smooth(aes(color = country)) +
  scale_x_date(date_labels = "%b %y", date_breaks =  "2 months",
    guide = guide_axis(angle = 60)) +
  labs(title = "New Per-Capita COVID-19 Cases Over Time",
    x = "Time", y = "Confirmed COVID-19 cases (per million)",
    caption = "Source: Our World in Data")
```
